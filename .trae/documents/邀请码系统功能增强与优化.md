# 邀请码系统功能增强与优化

## 一、页面布局优化

### 问题分析
当前页面切换时会出现跳来跳去的问题，主要原因是：
1. 生成邀请码页面和核销页面设置了 `max-width: 600px`
2. 历史记录页面设置了 `max-width: 1200px`
3. 所有页面都有独立的 `margin: 0 auto` 和 `padding: 20px`
4. 页面组件的容器样式不一致

### 解决方案
1. **移除页面组件中的独立容器样式**
   - 修改 `GenerateCode.vue`，移除 `.generate-code-container` 的 `max-width`、`margin` 和 `padding`
   - 修改 `History.vue`，移除 `.history-container` 的 `max-width`、`margin` 和 `padding`
   - 修改 `RedeemCode.vue`，移除 `.redeem-code-container` 的 `max-width`、`margin` 和 `padding`

2. **统一使用 App.vue 中的布局样式**
   - 所有页面组件直接使用 `el-card` 作为根元素
   - 利用 `App.vue` 中的 `.content-body` 类统一控制内容区域的样式
   - 确保所有页面组件的布局结构一致

## 二、账户管理功能

### 功能需求
1. 管理员账户和普通账户
2. 只有管理员可以调用API和管理账户
3. 账户的增删改查功能
4. 登录认证
5. API权限控制

### 实现方案

1. **数据库设计**
   - 创建 `users` 表，包含字段：id、username、password、role、created_at、updated_at
   - role 字段：admin（管理员）、user（普通用户）

2. **后端实现**
   - 创建 User 模型
   - 实现用户注册、登录、查询、修改、删除接口
   - 实现 JWT 认证
   - 实现 API 权限控制中间件

3. **前端实现**
   - 添加登录页面
   - 添加账户管理页面（仅管理员可见）
   - 实现登录状态管理
   - 实现路由权限控制

## 三、核销人员功能

### 功能需求
1. 核销时记录核销人员信息
2. 核销历史记录查询

### 实现方案

1. **数据库设计**
   - 扩展 `invitation_codes` 表，添加 `redeemed_by` 和 `redeemed_at` 字段
   - 创建 `redeemers` 表，包含字段：id、name、created_at、updated_at

2. **后端实现**
   - 创建 Redeemer 模型
   - 修改核销接口，记录核销人员信息
   - 扩展历史记录查询接口，支持核销人员过滤

3. **前端实现**
   - 修改核销页面，添加核销人员选择
   - 扩展历史记录页面，显示核销人员信息
   - 添加核销人员管理页面（仅管理员可见）

## 四、数据库脚本完善

### 完善内容
1. 账户表创建脚本
2. 核销人员表创建脚本
3. 初始数据插入脚本（默认管理员账户）
4. 表结构优化（索引、约束等）

### 实现方案
1. 修改现有的 `database.sql` 文件，添加新表的创建脚本
2. 添加初始数据插入脚本，创建默认管理员账户
3. 优化表结构，添加必要的索引和约束

## 五、实现步骤

1. **页面布局优化**（1-2小时）
   - 修改三个页面组件，移除独立的容器样式
   - 确保所有页面布局一致

2. **数据库设计与脚本完善**（1小时）
   - 设计并创建 users 表和 redeemers 表
   - 扩展 invitation_codes 表
   - 编写数据库初始化脚本

3. **后端功能实现**（3-4小时）
   - 创建 User 模型和 Redeemer 模型
   - 实现用户认证和授权功能
   - 实现账户管理接口
   - 实现核销人员管理接口
   - 修改现有的邀请码相关接口

4. **前端功能实现**（3-4小时）
   - 添加登录页面
   - 添加账户管理页面
   - 添加核销人员管理页面
   - 修改核销页面，添加核销人员选择
   - 实现路由权限控制
   - 优化页面样式和交互

5. **测试与调试**（1-2小时）
   - 测试所有功能是否正常工作
   - 调试可能出现的问题
   - 确保页面布局一致，切换流畅

## 六、预期效果

1. **页面布局**：所有页面布局一致，切换时不会出现跳来跳去的问题
2. **账户管理**：实现管理员和普通账户的权限管理，只有管理员可以调用API和管理账户
3. **核销功能**：核销时记录核销人员信息，支持核销历史记录查询
4. **数据库脚本**：完善的数据库脚本，包含所有表的创建和初始数据插入
5. **系统安全性**：实现了登录认证和API权限控制，提高系统安全性

## 七、技术栈

- **前端**：Vue3 + Element Plus + Vue Router + Axios
- **后端**：Node.js + Express + Sequelize + MySQL
- **认证**：JWT（JSON Web Token）
- **API文档**：Swagger

## 八、文件修改清单

### 前端文件
1. `frontend/src/views/GenerateCode.vue`：移除独立容器样式
2. `frontend/src/views/History.vue`：移除独立容器样式
3. `frontend/src/views/RedeemCode.vue`：移除独立容器样式
4. `frontend/src/views/Login.vue`：新增登录页面
5. `frontend/src/views/UserManagement.vue`：新增账户管理页面
6. `frontend/src/views/RedeemerManagement.vue`：新增核销人员管理页面
7. `frontend/src/router/index.js`：添加路由配置和权限控制
8. `frontend/src/utils/auth.js`：新增认证工具函数

### 后端文件
1. `backend/models/User.js`：新增用户模型
2. `backend/models/Redeemer.js`：新增核销人员模型
3. `backend/models/InvitationCode.js`：扩展邀请码模型
4. `backend/controllers/userController.js`：新增用户控制器
5. `backend/controllers/redeemerController.js`：新增核销人员控制器
6. `backend/controllers/invitationCodeController.js`：修改邀请码控制器
7. `backend/routes/userRoutes.js`：新增用户路由
8. `backend/routes/redeemerRoutes.js`：新增核销人员路由
9. `backend/middleware/auth.js`：新增认证中间件
10. `backend/middleware/permission.js`：新增权限控制中间件

### 数据库文件
1. `database.sql`：完善数据库脚本，添加新表创建和初始数据插入

通过以上优化和功能增强，邀请码系统将具备更完善的功能、更一致的页面布局和更高的安全性，能够更好地满足用户的需求。