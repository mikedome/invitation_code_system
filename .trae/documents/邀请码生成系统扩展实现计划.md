# 邀请码生成系统扩展实现计划

## 1. 前后端一起启动实现

### 1.1 创建根目录package.json
- 在项目根目录创建package.json文件
- 配置concurrently依赖，用于同时启动前后端服务
- 添加启动脚本，实现一键启动前后端

### 1.2 配置启动脚本
```json
{
  "name": "invitation-code-system",
  "scripts": {
    "start": "concurrently \"npm run start:backend\" \"npm run start:frontend\"",
    "start:backend": "cd backend && npm start",
    "start:frontend": "cd frontend && npm run dev"
  },
  "devDependencies": {
    "concurrently": "^8.2.2"
  }
}
```

## 2. 验证码核销功能实现

### 2.1 添加核销API
- 在`backend/controllers/invitationCodeController.js`中添加`redeemCode`方法
- 功能：将邀请码状态从`unused`改为`used`
- 检查邀请码是否存在、是否已使用

### 2.2 添加核销路由
- 在`backend/routes/invitationCodeRoutes.js`中添加核销路由
```javascript
router.post('/redeem', redeemCode);
```

## 3. 15天有效期实现

### 3.1 修改验证逻辑
- 在`validateCode`方法中添加有效期检查
- 计算当前时间与生成时间的差值，超过15天返回过期错误

### 3.2 修改核销逻辑
- 在`redeemCode`方法中添加有效期检查
- 过期的邀请码无法核销

### 3.3 有效期检查代码
```javascript
// 检查邀请码是否过期（15天有效期）
const now = new Date();
const generatedAt = new Date(invitationCode.generated_at);
const diffTime = Math.abs(now - generatedAt);
const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24));
if (diffDays > 15) {
  return res.status(400).json({ success: false, message: '邀请码已过期' });
}
```

## 4. API功能扩展

### 4.1 添加Swagger API文档
- 安装`swagger-jsdoc`和`swagger-ui-express`依赖
- 配置Swagger文档，自动生成API文档
- 访问路径：`/api-docs`

### 4.2 API文档配置
```javascript
const swaggerJsdoc = require('swagger-jsdoc');
const swaggerUi = require('swagger-ui-express');

const options = {
  definition: {
    openapi: '3.0.0',
    info: {
      title: '邀请码生成系统API',
      version: '1.0.0',
    },
  },
  apis: ['./routes/*.js'],
};

const specs = swaggerJsdoc(options);
app.use('/api-docs', swaggerUi.serve, swaggerUi.setup(specs));
```

### 4.3 添加API接口注释
- 在路由文件中添加Swagger注释，自动生成API文档
- 包括请求参数、响应示例等

## 5. 前端功能扩展

### 5.1 添加核销功能
- 在前端添加邀请码核销页面
- 输入邀请码进行核销
- 显示核销结果

### 5.2 添加有效期显示
- 在历史记录页面显示邀请码有效期
- 显示剩余有效期天数
- 过期邀请码显示红色标记

## 6. 数据库优化

### 6.1 添加索引优化
- 为`generated_at`字段添加索引，提高有效期查询性能
- 优化查询语句，减少数据库负载

## 7. 安全性增强

### 7.1 添加API密钥认证
- 考虑添加API密钥认证，提高API安全性
- 为不同系统分配不同的API密钥

### 7.2 输入验证增强
- 增强前端和后端的输入验证
- 防止SQL注入和XSS攻击

## 8. 测试计划

### 8.1 功能测试
- 测试邀请码生成功能
- 测试邀请码验证功能
- 测试邀请码核销功能
- 测试有效期检查功能

### 8.2 性能测试
- 测试高并发下的邀请码生成
- 测试大量数据下的历史记录查询

### 8.3 安全性测试
- 测试API密钥认证
- 测试输入验证

## 9. 部署计划

### 9.1 生产环境部署
- 配置生产环境的环境变量
- 优化生产环境的性能
- 配置日志记录

### 9.2 容器化部署（可选）
- 编写Dockerfile
- 编写docker-compose.yml
- 实现容器化部署

## 实现步骤时间安排

1. **第1天**：前后端一起启动配置、核销API实现
2. **第2天**：有效期检查逻辑实现、前端核销功能
3. **第3天**：API文档配置、安全性增强
4. **第4天**：测试和优化
5. **第5天**：部署和文档更新

## 预期成果

1. 实现前后端一键启动
2. 添加邀请码核销功能
3. 实现15天有效期限制
4. 过期邀请码无法核销
5. 添加完整的API文档
6. 增强系统安全性
7. 优化系统性能

## 技术栈

- **前端**：Vue3 + Vite + Element Plus + Vue Router + Axios
- **后端**：Node.js + Express + Sequelize + MySQL
- **文档**：Swagger
- **工具**：concurrently

## 风险评估

1. **数据库迁移风险**：需要确保数据库结构变更不会影响现有数据
2. **API兼容性风险**：需要确保新API与现有API兼容
3. **性能风险**：高并发下的系统性能需要测试和优化

## 解决方案

1. 数据库迁移使用Sequelize的`alter: true`选项，自动迁移表结构
2. 新API添加版本号，如`/api/v1/redeem`，确保兼容性
3. 进行性能测试，优化数据库索引和查询语句

## 后续扩展建议

1. 添加邀请码使用统计功能
2. 添加多语言支持
3. 添加邀请码模板功能，支持不同类型的邀请码
4. 添加短信/邮件发送邀请码功能
5. 添加邀请码使用数据分析功能